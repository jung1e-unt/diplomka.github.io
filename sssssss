function renderSelectedButtons(names){
    const box = $id('selectedTables');

    // ► сохраняем выбранные таблицы
    localStorage.setItem('selectedTables', JSON.stringify(names || []));

    if(!names || names.length===0){
        box.innerHTML = '<div class="hint-p">Ничего не выбрано</div>';
        currentTable = null;
        enableFilters(false);
        $id('content').innerHTML = '<div class="hint">Выберите таблицу слева.</div>';
        return;
    }

    names.sort((a,b)=>a.localeCompare(b,'ru'));
    box.innerHTML = names.map(name=>`
        <button class="selected-btn" data-table="${name}">
            ${name}
            <span class="selected-remove" data-remove="${name}">✕</span>
        </button>
    `).join('');

    box.querySelectorAll('.selected-btn').forEach(btn=>{
        btn.addEventListener('click', e=>{
            const rm = e.target.closest('[data-remove]');
            if(rm){
                const removed = rm.dataset.remove;
                const rest = names.filter(n => n !== removed);

                // вызов с новым списком
                renderSelectedButtons(rest);

                // снять чекбокс в списке
                const checkbox = document.querySelector(`input[data-table="${removed}"]`);
                if (checkbox) checkbox.checked = false;

                // если удалили активную таблицу
                if (currentTable === removed) {
                    currentTable = null;
                    enableFilters(false);
                    $id('content').innerHTML = '<div class="hint">Выберите таблицу слева.</div>';
                    const s = document.getElementById('startDate');
                    const e2 = document.getElementById('endDate');
                    if (s) s.value = '';
                    if (e2) e2.value = '';
                }
                return;
            }

            // при выборе таблицы
            currentTable = btn.dataset.table;
            lastLoadedWithFilter = false;

            enableFilters(true);

            const s = document.getElementById('startDate');
            const e2 = document.getElementById('endDate');
            if (s) s.value = '';
            if (e2) e2.value = '';
            if (typeof currentOffset !== 'undefined') currentOffset = 0;

            loadTable(currentTable, true);
        });
    });
}


document.addEventListener('DOMContentLoaded', () => {

    // ► получить сохранённые выбранные таблицы
    const saved = JSON.parse(localStorage.getItem('selectedTables') || '[]');

    if (saved.length > 0) {

        // выставить чекбоксы
        saved.forEach(name => {
            const cb = document.querySelector(`input[data-table="${name}"]`);
            if (cb) cb.checked = true;
        });

        // восстановить кнопки "выбранных таблиц"
        renderSelectedButtons(saved);
    }
});
